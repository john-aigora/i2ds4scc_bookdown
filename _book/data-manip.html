<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 4 Data Manipulation | Data Science for Sensory and Consumer Scientists</title>
  <meta name="description" content="Open development of data science book for sensory and consumer scientists." />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 4 Data Manipulation | Data Science for Sensory and Consumer Scientists" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Open development of data science book for sensory and consumer scientists." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 4 Data Manipulation | Data Science for Sensory and Consumer Scientists" />
  
  <meta name="twitter:description" content="Open development of data science book for sensory and consumer scientists." />
  

<meta name="author" content="John Ennis, Julien Delarue, and Thierry Worch" />


<meta name="date" content="2022-04-27" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="data-science.html"/>
<link rel="next" href="data-viz.html"/>
<script src="libs/header-attrs-2.6/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/tabwid-1.0.0/tabwid.css" rel="stylesheet" />


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  background-color: #f8f8f8; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #c4a000; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #000000; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #000000; } /* Function */
code span.im { } /* Import */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #000000; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Data Science for Sensory and Consumer Scientists</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#who-should-read-this-book"><i class="fa fa-check"></i>Who Should Read This Book?</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#how-to-use-this-book"><i class="fa fa-check"></i>How to Use This Book</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#acknowledgements"><i class="fa fa-check"></i>Acknowledgements</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="bienvenue.html"><a href="bienvenue.html"><i class="fa fa-check"></i><b>1</b> Bienvenue!</a>
<ul>
<li class="chapter" data-level="" data-path="bienvenue.html"><a href="bienvenue.html#why-data-science-for-sensory-and-consumer-science"><i class="fa fa-check"></i>Why Data Science for Sensory and Consumer Science?</a>
<ul>
<li class="chapter" data-level="" data-path="bienvenue.html"><a href="bienvenue.html#core-principles-in-sensory-and-consumer-science"><i class="fa fa-check"></i>Core principles in Sensory and Consumer Science</a></li>
<li class="chapter" data-level="" data-path="bienvenue.html"><a href="bienvenue.html#computational-sensory-science"><i class="fa fa-check"></i>Computational Sensory Science</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>Apéritifs</b></span></li>
<li class="chapter" data-level="2" data-path="start-R.html"><a href="start-R.html"><i class="fa fa-check"></i><b>2</b> Getting Started</a>
<ul>
<li class="chapter" data-level="2.1" data-path="start-R.html"><a href="start-R.html#r"><i class="fa fa-check"></i><b>2.1</b> R</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="start-R.html"><a href="start-R.html#why-learn-a-programming-language"><i class="fa fa-check"></i><b>2.1.1</b> Why Learn a Programming Language?</a></li>
<li class="chapter" data-level="2.1.2" data-path="start-R.html"><a href="start-R.html#why-r"><i class="fa fa-check"></i><b>2.1.2</b> Why R?</a></li>
<li class="chapter" data-level="2.1.3" data-path="start-R.html"><a href="start-R.html#steps-to-install-r"><i class="fa fa-check"></i><b>2.1.3</b> Steps to Install R</a></li>
<li class="chapter" data-level="2.1.4" data-path="start-R.html"><a href="start-R.html#introduction-to-the-magrittr-and-the-notion-of-pipes"><i class="fa fa-check"></i><b>2.1.4</b> Introduction to the <code>{magrittr}</code> and the notion of <em>pipes</em></a></li>
<li class="chapter" data-level="2.1.5" data-path="start-R.html"><a href="start-R.html#tips-on-how-to-read-this-book"><i class="fa fa-check"></i><b>2.1.5</b> Tips on <em>how to read this book?</em></a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="start-R.html"><a href="start-R.html#rstudio"><i class="fa fa-check"></i><b>2.2</b> RStudio</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="start-R.html"><a href="start-R.html#steps-to-install-rstudio"><i class="fa fa-check"></i><b>2.2.1</b> Steps to Install RStudio</a></li>
<li class="chapter" data-level="2.2.2" data-path="start-R.html"><a href="start-R.html#create-a-local-project"><i class="fa fa-check"></i><b>2.2.2</b> Create a Local Project</a></li>
<li class="chapter" data-level="2.2.3" data-path="start-R.html"><a href="start-R.html#install-and-load-packages"><i class="fa fa-check"></i><b>2.2.3</b> Install and Load Packages</a></li>
<li class="chapter" data-level="2.2.4" data-path="start-R.html"><a href="start-R.html#run-sample-code"><i class="fa fa-check"></i><b>2.2.4</b> Run Sample Code</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="start-R.html"><a href="start-R.html#git-and-github"><i class="fa fa-check"></i><b>2.3</b> Git and GitHub</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="start-R.html"><a href="start-R.html#git"><i class="fa fa-check"></i><b>2.3.1</b> Git</a></li>
<li class="chapter" data-level="2.3.2" data-path="start-R.html"><a href="start-R.html#github"><i class="fa fa-check"></i><b>2.3.2</b> GitHub</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="start-R.html"><a href="start-R.html#raw-material"><i class="fa fa-check"></i><b>2.4</b> RAW MATERIAL</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="start-R.html"><a href="start-R.html#principles"><i class="fa fa-check"></i><b>2.4.1</b> Principles</a></li>
<li class="chapter" data-level="2.4.2" data-path="start-R.html"><a href="start-R.html#tools"><i class="fa fa-check"></i><b>2.4.2</b> Tools</a></li>
<li class="chapter" data-level="2.4.3" data-path="start-R.html"><a href="start-R.html#documentation"><i class="fa fa-check"></i><b>2.4.3</b> Documentation</a></li>
<li class="chapter" data-level="2.4.4" data-path="start-R.html"><a href="start-R.html#version-control"><i class="fa fa-check"></i><b>2.4.4</b> Version control</a></li>
<li class="chapter" data-level="2.4.5" data-path="start-R.html"><a href="start-R.html#online-repositories-for-team-collaboration"><i class="fa fa-check"></i><b>2.4.5</b> Online repositories for team collaboration</a></li>
<li class="chapter" data-level="2.4.6" data-path="start-R.html"><a href="start-R.html#building-a-code-base"><i class="fa fa-check"></i><b>2.4.6</b> Building a code base</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>Hors d’Oeuvres</b></span></li>
<li class="chapter" data-level="3" data-path="data-science.html"><a href="data-science.html"><i class="fa fa-check"></i><b>3</b> Why Data Science?</a>
<ul>
<li class="chapter" data-level="3.1" data-path="data-science.html"><a href="data-science.html#history-and-definition"><i class="fa fa-check"></i><b>3.1</b> History and Definition</a></li>
<li class="chapter" data-level="3.2" data-path="data-science.html"><a href="data-science.html#benefits-of-data-science"><i class="fa fa-check"></i><b>3.2</b> Benefits of Data Science</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="data-science.html"><a href="data-science.html#reproducible-research"><i class="fa fa-check"></i><b>3.2.1</b> Reproducible Research</a></li>
<li class="chapter" data-level="3.2.2" data-path="data-science.html"><a href="data-science.html#standardized-reporting"><i class="fa fa-check"></i><b>3.2.2</b> Standardized Reporting</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="data-science.html"><a href="data-science.html#data-scientific-workflow"><i class="fa fa-check"></i><b>3.3</b> Data Scientific Workflow</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="data-science.html"><a href="data-science.html#data-collection2"><i class="fa fa-check"></i><b>3.3.1</b> Data Collection</a></li>
<li class="chapter" data-level="3.3.2" data-path="data-science.html"><a href="data-science.html#data-preparation"><i class="fa fa-check"></i><b>3.3.2</b> Data Preparation</a></li>
<li class="chapter" data-level="3.3.3" data-path="data-science.html"><a href="data-science.html#data-analysis2"><i class="fa fa-check"></i><b>3.3.3</b> Data Analysis</a></li>
<li class="chapter" data-level="3.3.4" data-path="data-science.html"><a href="data-science.html#value-delivery2"><i class="fa fa-check"></i><b>3.3.4</b> Value Delivery</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="data-science.html"><a href="data-science.html#how-to-learn-data-science"><i class="fa fa-check"></i><b>3.4</b> How to Learn Data Science</a></li>
<li class="chapter" data-level="3.5" data-path="data-science.html"><a href="data-science.html#cautions-dont-that-everybody-does"><i class="fa fa-check"></i><b>3.5</b> Cautions: Don’t that Everybody Does</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="data-manip.html"><a href="data-manip.html"><i class="fa fa-check"></i><b>4</b> Data Manipulation</a>
<ul>
<li class="chapter" data-level="4.1" data-path="data-manip.html"><a href="data-manip.html#chapter-overview"><i class="fa fa-check"></i><b>4.1</b> Chapter Overview</a></li>
<li class="chapter" data-level="4.2" data-path="data-manip.html"><a href="data-manip.html#why-manipulating-data"><i class="fa fa-check"></i><b>4.2</b> Why Manipulating Data?</a></li>
<li class="chapter" data-level="4.3" data-path="data-manip.html"><a href="data-manip.html#tidy-data"><i class="fa fa-check"></i><b>4.3</b> Tidying Data</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="data-manip.html"><a href="data-manip.html#simple-manipulations"><i class="fa fa-check"></i><b>4.3.1</b> Simple Manipulations</a></li>
<li class="chapter" data-level="4.3.2" data-path="data-manip.html"><a href="data-manip.html#reshaping-the-data"><i class="fa fa-check"></i><b>4.3.2</b> Reshaping the Data</a></li>
<li class="chapter" data-level="4.3.3" data-path="data-manip.html"><a href="data-manip.html#transformation-that-alters-the-data"><i class="fa fa-check"></i><b>4.3.3</b> Transformation that Alters the Data</a></li>
<li class="chapter" data-level="4.3.4" data-path="data-manip.html"><a href="data-manip.html#combining-data-from-different-sources"><i class="fa fa-check"></i><b>4.3.4</b> Combining Data from Different Sources</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="data-viz.html"><a href="data-viz.html"><i class="fa fa-check"></i><b>5</b> Data Visualization</a>
<ul>
<li class="chapter" data-level="5.1" data-path="data-viz.html"><a href="data-viz.html#design-principles"><i class="fa fa-check"></i><b>5.1</b> Design Principles</a></li>
<li class="chapter" data-level="5.2" data-path="data-viz.html"><a href="data-viz.html#table-making"><i class="fa fa-check"></i><b>5.2</b> Table Making</a></li>
<li class="chapter" data-level="5.3" data-path="data-viz.html"><a href="data-viz.html#chart-making"><i class="fa fa-check"></i><b>5.3</b> Chart Making</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="data-viz.html"><a href="data-viz.html#philosophy-of-ggplot2"><i class="fa fa-check"></i><b>5.3.1</b> Philosophy of <code>{ggplot2}</code></a></li>
<li class="chapter" data-level="5.3.2" data-path="data-viz.html"><a href="data-viz.html#getting-started-with-ggplot2"><i class="fa fa-check"></i><b>5.3.2</b> Getting started with <code>{ggplot2}</code></a></li>
<li class="chapter" data-level="5.3.3" data-path="data-viz.html"><a href="data-viz.html#common-charts"><i class="fa fa-check"></i><b>5.3.3</b> Common Charts</a></li>
<li class="chapter" data-level="5.3.4" data-path="data-viz.html"><a href="data-viz.html#miscealleneous"><i class="fa fa-check"></i><b>5.3.4</b> Miscealleneous</a></li>
<li class="chapter" data-level="5.3.5" data-path="data-viz.html"><a href="data-viz.html#few-tips-and-tricks"><i class="fa fa-check"></i><b>5.3.5</b> Few Tips and Tricks</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="auto-report.html"><a href="auto-report.html"><i class="fa fa-check"></i><b>6</b> Automated Reporting</a>
<ul>
<li class="chapter" data-level="6.1" data-path="auto-report.html"><a href="auto-report.html#what-and-why-automated-reporting"><i class="fa fa-check"></i><b>6.1</b> What and why Automated Reporting?</a></li>
<li class="chapter" data-level="6.2" data-path="auto-report.html"><a href="auto-report.html#integrating-reports-within-analyses-scripts"><i class="fa fa-check"></i><b>6.2</b> Integrating reports within analyses scripts</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="auto-report.html"><a href="auto-report.html#excel"><i class="fa fa-check"></i><b>6.2.1</b> Excel</a></li>
<li class="chapter" data-level="6.2.2" data-path="auto-report.html"><a href="auto-report.html#powerpoint"><i class="fa fa-check"></i><b>6.2.2</b> PowerPoint</a></li>
<li class="chapter" data-level="6.2.3" data-path="auto-report.html"><a href="auto-report.html#word"><i class="fa fa-check"></i><b>6.2.3</b> Word</a></li>
<li class="chapter" data-level="6.2.4" data-path="auto-report.html"><a href="auto-report.html#notes-on-applying-corporate-branding"><i class="fa fa-check"></i><b>6.2.4</b> Notes on applying corporate branding</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="auto-report.html"><a href="auto-report.html#integrating-analyses-scripts-within-your-reporting-tool"><i class="fa fa-check"></i><b>6.3</b> Integrating analyses scripts within your reporting tool</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="auto-report.html"><a href="auto-report.html#what-is-rmarkdown"><i class="fa fa-check"></i><b>6.3.1</b> What is <code>{rmarkdown}</code></a></li>
<li class="chapter" data-level="6.3.2" data-path="auto-report.html"><a href="auto-report.html#starting-with-rmarkdown"><i class="fa fa-check"></i><b>6.3.2</b> Starting with {rmarkdown}</a></li>
<li class="chapter" data-level="6.3.3" data-path="auto-report.html"><a href="auto-report.html#rmarkdown-through-a-simple-example"><i class="fa fa-check"></i><b>6.3.3</b> <code>{rmarkdown}</code> through a Simple Example</a></li>
<li class="chapter" data-level="6.3.4" data-path="auto-report.html"><a href="auto-report.html#creating-a-document-using-knitr"><i class="fa fa-check"></i><b>6.3.4</b> Creating a document using <code>{knitr}</code></a></li>
<li class="chapter" data-level="6.3.5" data-path="auto-report.html"><a href="auto-report.html#example-of-applications"><i class="fa fa-check"></i><b>6.3.5</b> Example of applications</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="auto-report.html"><a href="auto-report.html#to-go-further"><i class="fa fa-check"></i><b>6.4</b> To go further…</a></li>
</ul></li>
<li class="part"><span><b>Bon Appétit</b></span></li>
<li class="chapter" data-level="7" data-path="example-projects.html"><a href="example-projects.html"><i class="fa fa-check"></i><b>7</b> Example Project: The Biscuit Study</a>
<ul>
<li class="chapter" data-level="7.1" data-path="example-projects.html"><a href="example-projects.html#products"><i class="fa fa-check"></i><b>7.1</b> Products</a></li>
<li class="chapter" data-level="7.2" data-path="example-projects.html"><a href="example-projects.html#consumer-test"><i class="fa fa-check"></i><b>7.2</b> Consumer test</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="example-projects.html"><a href="example-projects.html#participants"><i class="fa fa-check"></i><b>7.2.1</b> Participants</a></li>
<li class="chapter" data-level="7.2.2" data-path="example-projects.html"><a href="example-projects.html#test-design"><i class="fa fa-check"></i><b>7.2.2</b> Test design</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="example-projects.html"><a href="example-projects.html#sensory-descriptive-analysis-data"><i class="fa fa-check"></i><b>7.3</b> Sensory descriptive analysis data</a></li>
<li class="chapter" data-level="7.4" data-path="example-projects.html"><a href="example-projects.html#summary-of-the-datasets"><i class="fa fa-check"></i><b>7.4</b> Summary of the datasets</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="data-collection.html"><a href="data-collection.html"><i class="fa fa-check"></i><b>8</b> Data Collection</a>
<ul>
<li class="chapter" data-level="8.1" data-path="data-collection.html"><a href="data-collection.html#design-1"><i class="fa fa-check"></i><b>8.1</b> Design</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="data-collection.html"><a href="data-collection.html#designs-of-sensory-experiments"><i class="fa fa-check"></i><b>8.1.1</b> Designs of sensory experiments</a></li>
<li class="chapter" data-level="8.1.2" data-path="data-collection.html"><a href="data-collection.html#product-related-designs"><i class="fa fa-check"></i><b>8.1.2</b> Product-related designs</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="data-collection.html"><a href="data-collection.html#execute-1"><i class="fa fa-check"></i><b>8.2</b> Execute</a></li>
<li class="chapter" data-level="8.3" data-path="data-collection.html"><a href="data-collection.html#data-import"><i class="fa fa-check"></i><b>8.3</b> Import</a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="data-collection.html"><a href="data-collection.html#importing-structured-excel-file"><i class="fa fa-check"></i><b>8.3.1</b> Importing Structured Excel File</a></li>
<li class="chapter" data-level="8.3.2" data-path="data-collection.html"><a href="data-collection.html#importing-unstructured-excel-file"><i class="fa fa-check"></i><b>8.3.2</b> Importing Unstructured Excel File</a></li>
<li class="chapter" data-level="8.3.3" data-path="data-collection.html"><a href="data-collection.html#import-mult-sheet"><i class="fa fa-check"></i><b>8.3.3</b> Importing Data Stored in Multiple Sheets</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="data-prep.html"><a href="data-prep.html"><i class="fa fa-check"></i><b>9</b> Data Preparation</a>
<ul>
<li class="chapter" data-level="9.1" data-path="data-prep.html"><a href="data-prep.html#inspect"><i class="fa fa-check"></i><b>9.1</b> Inspect</a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="data-prep.html"><a href="data-prep.html#data-inspection"><i class="fa fa-check"></i><b>9.1.1</b> Data Inspection</a></li>
<li class="chapter" data-level="9.1.2" data-path="data-prep.html"><a href="data-prep.html#missing-data"><i class="fa fa-check"></i><b>9.1.2</b> Missing Data</a></li>
<li class="chapter" data-level="9.1.3" data-path="data-prep.html"><a href="data-prep.html#design-inspection"><i class="fa fa-check"></i><b>9.1.3</b> Design Inspection</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="data-prep.html"><a href="data-prep.html#clean"><i class="fa fa-check"></i><b>9.2</b> Clean</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="data-prep.html"><a href="data-prep.html#renaming-variables-1"><i class="fa fa-check"></i><b>9.2.1</b> Renaming Variables</a></li>
<li class="chapter" data-level="9.2.2" data-path="data-prep.html"><a href="data-prep.html#handling-data-type"><i class="fa fa-check"></i><b>9.2.2</b> Handling Data Type</a></li>
<li class="chapter" data-level="9.2.3" data-path="data-prep.html"><a href="data-prep.html#converting-between-types"><i class="fa fa-check"></i><b>9.2.3</b> Converting between Types</a></li>
<li class="chapter" data-level="9.2.4" data-path="data-prep.html"><a href="data-prep.html#handling-missing-values"><i class="fa fa-check"></i><b>9.2.4</b> Handling Missing Values</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="data-analysis.html"><a href="data-analysis.html"><i class="fa fa-check"></i><b>10</b> Data Analysis</a>
<ul>
<li class="chapter" data-level="10.1" data-path="data-analysis.html"><a href="data-analysis.html#chapter-overview-1"><i class="fa fa-check"></i><b>10.1</b> Chapter Overview</a></li>
<li class="chapter" data-level="10.2" data-path="data-analysis.html"><a href="data-analysis.html#sensory-data"><i class="fa fa-check"></i><b>10.2</b> Sensory Data</a></li>
<li class="chapter" data-level="10.3" data-path="data-analysis.html"><a href="data-analysis.html#demographic-and-questionnaire-data"><i class="fa fa-check"></i><b>10.3</b> Demographic and Questionnaire Data</a>
<ul>
<li class="chapter" data-level="10.3.1" data-path="data-analysis.html"><a href="data-analysis.html#demographic-data-frequency-and-proportion"><i class="fa fa-check"></i><b>10.3.1</b> Demographic Data: Frequency and Proportion</a></li>
<li class="chapter" data-level="10.3.2" data-path="data-analysis.html"><a href="data-analysis.html#personality-traits-and-eating-behavior-tfeq-data"><i class="fa fa-check"></i><b>10.3.2</b> Personality traits and eating behavior: TFEQ data</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="data-analysis.html"><a href="data-analysis.html#consumer-data"><i class="fa fa-check"></i><b>10.4</b> Consumer Data</a></li>
<li class="chapter" data-level="10.5" data-path="data-analysis.html"><a href="data-analysis.html#combining-sensory-and-consumer-data"><i class="fa fa-check"></i><b>10.5</b> Combining Sensory and Consumer Data</a>
<ul>
<li class="chapter" data-level="10.5.1" data-path="data-analysis.html"><a href="data-analysis.html#internal-preference-mapping"><i class="fa fa-check"></i><b>10.5.1</b> Internal Preference Mapping</a></li>
<li class="chapter" data-level="10.5.2" data-path="data-analysis.html"><a href="data-analysis.html#consumers-clustering"><i class="fa fa-check"></i><b>10.5.2</b> Consumers Clustering</a></li>
<li class="chapter" data-level="10.5.3" data-path="data-analysis.html"><a href="data-analysis.html#drivers-of-liking"><i class="fa fa-check"></i><b>10.5.3</b> Drivers of Liking</a></li>
<li class="chapter" data-level="10.5.4" data-path="data-analysis.html"><a href="data-analysis.html#external-preference-mapping"><i class="fa fa-check"></i><b>10.5.4</b> External Preference Mapping</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="11" data-path="value-delivery.html"><a href="value-delivery.html"><i class="fa fa-check"></i><b>11</b> Value Delivery</a>
<ul>
<li class="chapter" data-level="11.1" data-path="value-delivery.html"><a href="value-delivery.html#communicate2"><i class="fa fa-check"></i><b>11.1</b> Communicate</a>
<ul>
<li class="chapter" data-level="11.1.1" data-path="value-delivery.html"><a href="value-delivery.html#exploratory-explanatory-and-predictive-analysis"><i class="fa fa-check"></i><b>11.1.1</b> Exploratory, Explanatory and Predictive Analysis</a></li>
<li class="chapter" data-level="11.1.2" data-path="value-delivery.html"><a href="value-delivery.html#audience-awareness"><i class="fa fa-check"></i><b>11.1.2</b> Audience Awareness</a></li>
<li class="chapter" data-level="11.1.3" data-path="value-delivery.html"><a href="value-delivery.html#method-to-communicate"><i class="fa fa-check"></i><b>11.1.3</b> Method to Communicate</a></li>
<li class="chapter" data-level="11.1.4" data-path="value-delivery.html"><a href="value-delivery.html#storytelling"><i class="fa fa-check"></i><b>11.1.4</b> Storytelling</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="value-delivery.html"><a href="value-delivery.html#reformulate2"><i class="fa fa-check"></i><b>11.2</b> Reformulate</a></li>
<li class="chapter" data-level="11.3" data-path="value-delivery.html"><a href="value-delivery.html#to-go-further-1"><i class="fa fa-check"></i><b>11.3</b> To go further…</a></li>
</ul></li>
<li class="part"><span><b>Haute Cuisine</b></span></li>
<li class="chapter" data-level="12" data-path="machine-learning.html"><a href="machine-learning.html"><i class="fa fa-check"></i><b>12</b> Machine Learning</a>
<ul>
<li class="chapter" data-level="12.1" data-path="machine-learning.html"><a href="machine-learning.html#methods-overview"><i class="fa fa-check"></i><b>12.1</b> Methods Overview</a>
<ul>
<li class="chapter" data-level="12.1.1" data-path="machine-learning.html"><a href="machine-learning.html#unsupervised-learning"><i class="fa fa-check"></i><b>12.1.1</b> Unsupervised learning</a></li>
<li class="chapter" data-level="12.1.2" data-path="machine-learning.html"><a href="machine-learning.html#supervised-learning"><i class="fa fa-check"></i><b>12.1.2</b> Supervised learning</a></li>
</ul></li>
<li class="chapter" data-level="12.2" data-path="machine-learning.html"><a href="machine-learning.html#key-topics"><i class="fa fa-check"></i><b>12.2</b> Key Topics</a>
<ul>
<li class="chapter" data-level="12.2.1" data-path="machine-learning.html"><a href="machine-learning.html#model-validation"><i class="fa fa-check"></i><b>12.2.1</b> Model Validation</a></li>
<li class="chapter" data-level="12.2.2" data-path="machine-learning.html"><a href="machine-learning.html#interpretability"><i class="fa fa-check"></i><b>12.2.2</b> Interpretability</a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="machine-learning.html"><a href="machine-learning.html#common-applications"><i class="fa fa-check"></i><b>12.3</b> Common Applications</a>
<ul>
<li class="chapter" data-level="12.3.1" data-path="machine-learning.html"><a href="machine-learning.html#predicting-sensory-profiles-from-instrumental-data"><i class="fa fa-check"></i><b>12.3.1</b> Predicting sensory profiles from instrumental data</a></li>
<li class="chapter" data-level="12.3.2" data-path="machine-learning.html"><a href="machine-learning.html#predicting-consumer-response-from-sensory-profiles"><i class="fa fa-check"></i><b>12.3.2</b> Predicting consumer response from sensory profiles</a></li>
<li class="chapter" data-level="12.3.3" data-path="machine-learning.html"><a href="machine-learning.html#characterizing-consumer-clusters"><i class="fa fa-check"></i><b>12.3.3</b> Characterizing consumer clusters</a></li>
</ul></li>
<li class="chapter" data-level="12.4" data-path="machine-learning.html"><a href="machine-learning.html#code"><i class="fa fa-check"></i><b>12.4</b> Code</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="text-analysis.html"><a href="text-analysis.html"><i class="fa fa-check"></i><b>13</b> Text Analysis</a>
<ul>
<li class="chapter" data-level="13.1" data-path="text-analysis.html"><a href="text-analysis.html#application-of-text-analysis-in-sensory-and-consumer-science"><i class="fa fa-check"></i><b>13.1</b> Application of Text Analysis in Sensory and Consumer Science</a>
<ul>
<li class="chapter" data-level="13.1.1" data-path="text-analysis.html"><a href="text-analysis.html#text-analysis-as-way-to-describe-products"><i class="fa fa-check"></i><b>13.1.1</b> Text analysis as way to describe products</a></li>
<li class="chapter" data-level="13.1.2" data-path="text-analysis.html"><a href="text-analysis.html#objectives-of-text-analysis"><i class="fa fa-check"></i><b>13.1.2</b> Objectives of Text Analysis</a></li>
<li class="chapter" data-level="13.1.3" data-path="text-analysis.html"><a href="text-analysis.html#warnings"><i class="fa fa-check"></i><b>13.1.3</b> Warnings</a></li>
</ul></li>
<li class="chapter" data-level="13.2" data-path="text-analysis.html"><a href="text-analysis.html#illustration-using-sorting-task-data"><i class="fa fa-check"></i><b>13.2</b> Illustration using Sorting Task Data</a>
<ul>
<li class="chapter" data-level="13.2.1" data-path="text-analysis.html"><a href="text-analysis.html#data-pre-processing"><i class="fa fa-check"></i><b>13.2.1</b> Data Pre-processing</a></li>
<li class="chapter" data-level="13.2.2" data-path="text-analysis.html"><a href="text-analysis.html#introduction-to-working-with-strings-stringr"><i class="fa fa-check"></i><b>13.2.2</b> Introduction to working with strings (<code>{stringr}</code>)</a></li>
<li class="chapter" data-level="13.2.3" data-path="text-analysis.html"><a href="text-analysis.html#tokenization"><i class="fa fa-check"></i><b>13.2.3</b> Tokenization</a></li>
<li class="chapter" data-level="13.2.4" data-path="text-analysis.html"><a href="text-analysis.html#simple-transformation-lowercase"><i class="fa fa-check"></i><b>13.2.4</b> Simple Transformation (lowercase)</a></li>
<li class="chapter" data-level="13.2.5" data-path="text-analysis.html"><a href="text-analysis.html#stopwords"><i class="fa fa-check"></i><b>13.2.5</b> Stopwords</a></li>
<li class="chapter" data-level="13.2.6" data-path="text-analysis.html"><a href="text-analysis.html#stemming-and-lemmatization"><i class="fa fa-check"></i><b>13.2.6</b> Stemming and Lemmatization</a></li>
</ul></li>
<li class="chapter" data-level="13.3" data-path="text-analysis.html"><a href="text-analysis.html#text-analysis-1"><i class="fa fa-check"></i><b>13.3</b> Text Analysis</a>
<ul>
<li class="chapter" data-level="13.3.1" data-path="text-analysis.html"><a href="text-analysis.html#raw-frequencies-and-visualization"><i class="fa fa-check"></i><b>13.3.1</b> Raw Frequencies and Visualization</a></li>
<li class="chapter" data-level="13.3.2" data-path="text-analysis.html"><a href="text-analysis.html#bigrams-n-grams"><i class="fa fa-check"></i><b>13.3.2</b> Bigrams, <em>n</em>-grams</a></li>
<li class="chapter" data-level="13.3.3" data-path="text-analysis.html"><a href="text-analysis.html#word-embedding"><i class="fa fa-check"></i><b>13.3.3</b> Word Embedding</a></li>
<li class="chapter" data-level="13.3.4" data-path="text-analysis.html"><a href="text-analysis.html#sentiment-analysis"><i class="fa fa-check"></i><b>13.3.4</b> Sentiment Analysis</a></li>
</ul></li>
<li class="chapter" data-level="13.4" data-path="text-analysis.html"><a href="text-analysis.html#to-go-further-2"><i class="fa fa-check"></i><b>13.4</b> To go further…</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="dashboards.html"><a href="dashboards.html"><i class="fa fa-check"></i><b>14</b> Dashboards</a>
<ul>
<li class="chapter" data-level="14.1" data-path="dashboards.html"><a href="dashboards.html#objectives"><i class="fa fa-check"></i><b>14.1</b> Objectives</a></li>
<li class="chapter" data-level="14.2" data-path="dashboards.html"><a href="dashboards.html#introduction-to-shiny-through-an-example"><i class="fa fa-check"></i><b>14.2</b> Introduction to Shiny through an Example</a>
<ul>
<li class="chapter" data-level="14.2.1" data-path="dashboards.html"><a href="dashboards.html#what-is-a-shiny-application"><i class="fa fa-check"></i><b>14.2.1</b> What is a Shiny application?</a></li>
<li class="chapter" data-level="14.2.2" data-path="dashboards.html"><a href="dashboards.html#starting-with-shiny"><i class="fa fa-check"></i><b>14.2.2</b> Starting with Shiny</a></li>
<li class="chapter" data-level="14.2.3" data-path="dashboards.html"><a href="dashboards.html#deploying-the-application"><i class="fa fa-check"></i><b>14.2.3</b> Deploying the Application</a></li>
</ul></li>
<li class="chapter" data-level="14.3" data-path="dashboards.html"><a href="dashboards.html#to-go-further-3"><i class="fa fa-check"></i><b>14.3</b> To go further…</a>
<ul>
<li class="chapter" data-level="14.3.1" data-path="dashboards.html"><a href="dashboards.html#personalizing-and-tuning-your-application"><i class="fa fa-check"></i><b>14.3.1</b> Personalizing and Tuning your application</a></li>
<li class="chapter" data-level="14.3.2" data-path="dashboards.html"><a href="dashboards.html#upgrading-tables"><i class="fa fa-check"></i><b>14.3.2</b> Upgrading Tables</a></li>
<li class="chapter" data-level="14.3.3" data-path="dashboards.html"><a href="dashboards.html#building-dashboard"><i class="fa fa-check"></i><b>14.3.3</b> Building Dashboard</a></li>
<li class="chapter" data-level="14.3.4" data-path="dashboards.html"><a href="dashboards.html#interactive-graphics"><i class="fa fa-check"></i><b>14.3.4</b> Interactive Graphics</a></li>
<li class="chapter" data-level="14.3.5" data-path="dashboards.html"><a href="dashboards.html#interactive-documents"><i class="fa fa-check"></i><b>14.3.5</b> Interactive Documents</a></li>
<li class="chapter" data-level="14.3.6" data-path="dashboards.html"><a href="dashboards.html#documentation-and-books"><i class="fa fa-check"></i><b>14.3.6</b> Documentation and Books</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>Digestifs</b></span></li>
<li class="chapter" data-level="15" data-path="next-steps.html"><a href="next-steps.html"><i class="fa fa-check"></i><b>15</b> Conclusion and Next Steps</a>
<ul>
<li class="chapter" data-level="15.1" data-path="next-steps.html"><a href="next-steps.html#sensory-analysis-in-r"><i class="fa fa-check"></i><b>15.1</b> Sensory Analysis in R</a></li>
<li class="chapter" data-level="15.2" data-path="next-steps.html"><a href="next-steps.html#other-recommended-resources"><i class="fa fa-check"></i><b>15.2</b> Other Recommended Resources</a>
<ul>
<li class="chapter" data-level="15.2.1" data-path="next-steps.html"><a href="next-steps.html#r-for-data-science"><i class="fa fa-check"></i><b>15.2.1</b> R for Data Science</a></li>
<li class="chapter" data-level="15.2.2" data-path="next-steps.html"><a href="next-steps.html#hands-on-machine-learning-with-r"><i class="fa fa-check"></i><b>15.2.2</b> Hands-On Machine Learning with R</a></li>
<li class="chapter" data-level="15.2.3" data-path="next-steps.html"><a href="next-steps.html#factoextra"><i class="fa fa-check"></i><b>15.2.3</b> FactoExtra</a></li>
<li class="chapter" data-level="15.2.4" data-path="next-steps.html"><a href="next-steps.html#r-graphics-cookbook"><i class="fa fa-check"></i><b>15.2.4</b> R Graphics Cookbook</a></li>
<li class="chapter" data-level="15.2.5" data-path="next-steps.html"><a href="next-steps.html#storytelling-with-data"><i class="fa fa-check"></i><b>15.2.5</b> Storytelling with Data</a></li>
<li class="chapter" data-level="15.2.6" data-path="next-steps.html"><a href="next-steps.html#text-mining-wtih-r"><i class="fa fa-check"></i><b>15.2.6</b> Text Mining wtih R</a></li>
</ul></li>
<li class="chapter" data-level="15.3" data-path="next-steps.html"><a href="next-steps.html#databases-graph-and-otherwise"><i class="fa fa-check"></i><b>15.3</b> Databases (Graph and Otherwise)</a></li>
<li class="chapter" data-level="15.4" data-path="next-steps.html"><a href="next-steps.html#python-and-other-languages"><i class="fa fa-check"></i><b>15.4</b> Python and Other Languages</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="bibliography.html"><a href="bibliography.html"><i class="fa fa-check"></i>Bibliography</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Data Science for Sensory and Consumer Scientists</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="data-manip" class="section level1" number="4">
<h1><span class="header-section-number">Chapter 4</span> Data Manipulation</h1>
<!-- 
MENTIONING SOMEWHERE THAT SOME OF THE TRANSFORMATIONS MADE ARE TEMPORARY AS THEY ARE NOT BEING SAVED, SO RE-USING THE SAME DATA WILL STILL BE BACK TO ITS ORIGINAL VERSION...
WE ARE ALSO MISSING A SECTION EXPLAINING PIPES...AND ADDING THAT INTO APERITIFS MIGHT BE CONFUSING AS APERITIFS IS AT THE END OF THE BOOK...SO SHOULD WE EXPLAIN IT IN THE INTRODUCTION? 

TW: not completely sure where we are now with the re-organization of the book.
I've added a sentence to explain here that readers need to look at the pre-requisite (how to read this book)
Also, the section "pre-requisite" (or could be called "summary") is something I think John suggested which provides information about what are we going to use (which data set), which main packages, and what are the learning points. I think this is a good thing to have for readers to quickly see what's in there. But for printing, maybe this should be written in a box, or in italic, to separate it from the rest.
-->
<div id="chapter-overview" class="section level2" number="4.1">
<h2><span class="header-section-number">4.1</span> Chapter Overview</h2>
<p>In this section, you will learn how to manipulate and transform your data. This goes from very simple transformation (e.g. renaming columns, sorting tables, relocating variables, etc.) to more complex work (transposing parts of the table, combining/merging tables, etc.).</p>
<p>Such transformations are done through simple examples, including the computation of the sensory profiles (mean scores per product and attribute) of products by following different transformations path. The data set used include <em>Sensory Profile.xlsx</em> mainly, as well as made up data set (<em>Consumer Test.xlsx</em>) to illustrate how to join different data set.</p>
<p>Most of the functions we use are accessible through the <code>{tidyverse}</code>. For importing the data, the usual <code>{here}</code> and <code>{readxl}</code> are used.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="data-manip.html#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb14-2"><a href="data-manip.html#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(here)</span>
<span id="cb14-3"><a href="data-manip.html#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readxl)</span></code></pre></div>
<p>Note that in many cases, we are not saving the results of the transformation that we do. If you want to apply these changes to your data set, please visit section (APERITIF).</p>
</div>
<div id="why-manipulating-data" class="section level2" number="4.2">
<h2><span class="header-section-number">4.2</span> Why Manipulating Data?</h2>
<p>In sensory science, different data collection tools (e.g. different devices, software, methodologies, etc.) may provide the same data in different ways. Also, different statistical analyses may require having the data structured in different formats.</p>
<p>A simple example to illustrate this latter point is the analysis of liking data.
Let C consumers provide their hedonic assessments on P samples. To evaluate if samples have received different liking means at the population level, an ANOVA is performed on a long thin table with 3 columns (consumer, sample, and the liking scores), where the combination of CxP is spread in rows.</p>
<!-- Insert Figure illustrating the data structure -->
<p>However, to assess whether consumers have the same preference patterns at the individual level, internal preference mapping or cluster analysis is performed, both these analyses requiring as input a short and large table with P rows and C columns.</p>
<!-- Insert Figure illustrating the data structure -->
<p>Another example of data manipulation consists in summarizing data, by for instance computing the mean by product for each sensory attribute (hence creating the so-called sensory profiles), or to generate frequency tables (e.g. proportions of male/female, distribution of the liking scores by sample, contingency table for CATA data, etc.)</p>
<!-- Insert Figure illustrating the data structure -->
<p>For these reasons, it is essential to learn to manipulate data and transition from one structure to another.</p>
<p>Different ways to transform your data are illustrated through several simple examples<a href="#fn8" class="footnote-ref" id="fnref8"><sup>8</sup></a>.</p>
</div>
<div id="tidy-data" class="section level2" number="4.3">
<h2><span class="header-section-number">4.3</span> Tidying Data</h2>
<p>Hadley Wickham (<span class="citation"><a href="bibliography.html#ref-Wickham2014" role="doc-biblioref">Wickham</a> (<a href="bibliography.html#ref-Wickham2014" role="doc-biblioref">2014</a>)</span>) defined ‘tidy data’ as “data sets that are arranged such that each variable is a column and each observation (or case) is a row.” Depending on the statistical unit to consider and the analyses to perform, data may need to be manipulated to be presented in a tidy form.</p>
<div id="simple-manipulations" class="section level3" number="4.3.1">
<h3><span class="header-section-number">4.3.1</span> Simple Manipulations</h3>
<p>The notion of ‘simple manipulations’ proposed here consists in data transformations that could easily be performed in other software such as Excel (using copy-paste, sorting and filtering, creating a pivot table, etc.). However, we strongly recommend performing any sorts of transformation in R as this will reduce the risk of errors, typically be faster, more reliable, and will be reusable if you need to perform the same operations on similar data in the future (including updated versions of the current data set). Moreover, these operations will become easier and more natural for you to use as you familiarize yourself with them.</p>
<div id="handling-columns" class="section level4" number="4.3.1.1">
<h4><span class="header-section-number">4.3.1.1</span> Handling Columns</h4>
<div id="renaming-variables" class="section level5" number="4.3.1.1.1">
<h5><span class="header-section-number">4.3.1.1.1</span> Renaming Variables</h5>
<p>The first simple transformation we consider consists of renaming one or multiple variables. This procedure can easily be done using the <code>rename()</code> function from the <code>{dplyr}</code> package. In each of the examples below, we use the <code>names()</code> function to show just the names of the resulting data set.</p>
<p>In our sensory file<a href="#fn9" class="footnote-ref" id="fnref9"><sup>9</sup></a>, let’s rename ‘Judge’ into ‘Panellist,’ and ‘Product’ into ‘Sample’ (here we apply transformations without saving the results, so the original data set remains unchanged).</p>
<p>First, here are the original names:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="data-manip.html#cb15-1" aria-hidden="true" tabindex="-1"></a>sensory <span class="sc">%&gt;%</span> </span>
<span id="cb15-2"><a href="data-manip.html#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>()</span></code></pre></div>
<p>To do so, we indicate in <code>rename()</code> that <code>newname</code> is replacing <code>oldname</code> as following <code>rename(newname = oldname)</code>. Additionally, we can apply multiple changes by simply separating them with a <code>,</code>:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="data-manip.html#cb16-1" aria-hidden="true" tabindex="-1"></a>sensory <span class="sc">%&gt;%</span> </span>
<span id="cb16-2"><a href="data-manip.html#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">Panellist =</span> Judge, <span class="at">Sample =</span> Product) <span class="sc">%&gt;%</span> </span>
<span id="cb16-3"><a href="data-manip.html#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>()</span></code></pre></div>
<p>If this procedure of renaming variables should be applied on many variables following a structured form (e.g. transforming names into snake_case, CamelCase, etc.) (see <a href="https://en.wikipedia.org/wiki/Letter_case#Use_within_programming_languages">https://en.wikipedia.org/wiki/Letter_case#Use_within_programming_languages</a> for more information), the use of the <code>{janitor}</code> package comes handy thanks to its <code>clean_names()</code> function and the <code>case</code> parameter:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="data-manip.html#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(janitor)</span>
<span id="cb17-2"><a href="data-manip.html#cb17-2" aria-hidden="true" tabindex="-1"></a>sensory <span class="sc">%&gt;%</span> </span>
<span id="cb17-3"><a href="data-manip.html#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">clean_names</span>(<span class="at">case=</span><span class="st">&quot;snake&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb17-4"><a href="data-manip.html#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>()</span></code></pre></div>
<p>Note that the <code>{janitor}</code> package offers many options, and although the transformation is performed here on all the variables, it is possible to apply it on certain variables only.</p>
</div>
<div id="re-organizing-columns" class="section level5" number="4.3.1.1.2">
<h5><span class="header-section-number">4.3.1.1.2</span> Re-Organizing Columns</h5>
<p>Another simple transformation consists in re-organizing the data set, either by re-ordering (including removing) columns, or by selecting some rows based on a certain criteria.</p>
<p>For re-ordering columns, <code>relocate()</code> is being used. This function allows re-positioning a (set of) variable(s) before or after another variable. By re-using the <code>sensory</code> data set, let’s position all the variables starting with ‘Qty’ between <code>Product</code> and <code>Shiny</code>. This can be specified into two different ways:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="data-manip.html#cb18-1" aria-hidden="true" tabindex="-1"></a>sensory <span class="sc">%&gt;%</span> </span>
<span id="cb18-2"><a href="data-manip.html#cb18-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(<span class="fu">starts_with</span>(<span class="st">&quot;Qty&quot;</span>), <span class="at">.after=</span>Product) <span class="sc">%&gt;%</span> </span>
<span id="cb18-3"><a href="data-manip.html#cb18-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>()</span>
<span id="cb18-4"><a href="data-manip.html#cb18-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-5"><a href="data-manip.html#cb18-5" aria-hidden="true" tabindex="-1"></a>sensory <span class="sc">%&gt;%</span> </span>
<span id="cb18-6"><a href="data-manip.html#cb18-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(<span class="fu">starts_with</span>(<span class="st">&quot;Qty&quot;</span>), <span class="at">.before=</span>Shiny) <span class="sc">%&gt;%</span> </span>
<span id="cb18-7"><a href="data-manip.html#cb18-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">names</span>()</span></code></pre></div>
<p>Another very important function regarding columns transformation is the <code>select()</code> function (from the <code>{dplyr}</code> package<a href="#fn10" class="footnote-ref" id="fnref10"><sup>10</sup></a>) allows selecting a set of variables, by simply informing the variables that should be kept in the data. Let’s limit ourselves in selecting <code>Judge</code>, <code>Product</code>, and <code>Shiny</code>:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="data-manip.html#cb19-1" aria-hidden="true" tabindex="-1"></a>sensory <span class="sc">%&gt;%</span> </span>
<span id="cb19-2"><a href="data-manip.html#cb19-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(Judge, Product, Shiny)</span></code></pre></div>
<p>When a long series of variables should be kept in the same order, the use of the <code>:</code> is used.
Let’s only keep the variables related to Flavor, hence going from <code>Cereal flavor</code> to <code>Warming</code>:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="data-manip.html#cb20-1" aria-hidden="true" tabindex="-1"></a>sensory <span class="sc">%&gt;%</span> </span>
<span id="cb20-2"><a href="data-manip.html#cb20-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(Judge, Product, <span class="st">`</span><span class="at">Cereal flavor</span><span class="st">`</span><span class="sc">:</span>Warming)</span></code></pre></div>
<!-- why does 'Cereal flavor' has the '' and not Warming? Is it because of the blank between Cereal and flavor? If so, it might be worth adding a note about that. 

TW: added in the aperitif
-->
<p>However, when only one (or few) variable needs to be removed, it is easier to specify which one to remove rather than informing all the ones to keep. Such solution is then done using the <code>-</code> sign. The previous example can then be obtained using the following code:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="data-manip.html#cb21-1" aria-hidden="true" tabindex="-1"></a>sensory <span class="sc">%&gt;%</span> </span>
<span id="cb21-2"><a href="data-manip.html#cb21-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(Shiny, Melting))</span></code></pre></div>
<p>The selection process of variables can be further informed through functions such as <code>starts_with()</code>, <code>ends_with()</code>, and <code>contains()</code>, which all select variables that either starts, ends, or contains a certain character or sequence of character. To illustrate this, let’s only keep the variables that starts with ‘Qty’:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="data-manip.html#cb22-1" aria-hidden="true" tabindex="-1"></a>sensory <span class="sc">%&gt;%</span> </span>
<span id="cb22-2"><a href="data-manip.html#cb22-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">&quot;Qty&quot;</span>))</span></code></pre></div>
<p>Rather than selecting variables based on their names, we can also select them based on their position (e.g. <code>dplyr::select(2:5)</code> to keep the variables that are at position 2 to 5), or following a certain ‘rule’ using the <code>where()</code> function. In that case, let’s consider all the variables that are numerical, which automatically removes <code>Judge</code> and <code>Product</code>:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="data-manip.html#cb23-1" aria-hidden="true" tabindex="-1"></a>sensory <span class="sc">%&gt;%</span> </span>
<span id="cb23-2"><a href="data-manip.html#cb23-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">where</span>(is.numeric))</span></code></pre></div>
<p><strong>Remark</strong>: <code>dplyr::select()</code> is a very powerful function that facilitates selection of complex variables through very intuitive functions. Ultimately, it can also be used to <code>relocate()</code> and even <code>rename()</code> variables, as shown in the example below:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="data-manip.html#cb24-1" aria-hidden="true" tabindex="-1"></a>sensory <span class="sc">%&gt;%</span> </span>
<span id="cb24-2"><a href="data-manip.html#cb24-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="at">Panellist =</span> Judge, <span class="at">Sample =</span> Product, Shiny<span class="sc">:</span>Sticky, <span class="sc">-</span><span class="fu">starts_with</span>(<span class="st">&quot;Qty&quot;</span>))</span></code></pre></div>
<p>More examples illustrating the use of <code>dplyr::select()</code> are provided throughout the book.</p>
</div>
<div id="creating-columns" class="section level5" number="4.3.1.1.3">
<h5><span class="header-section-number">4.3.1.1.3</span> Creating Columns</h5>
<p>In some cases, new variables need to be created from existing ones. Examples of such situations include taking the quadratic term of a sensory attribute to test for curvature, or simply considering a new variables as the sum or the subtraction between two (or more). Such creation of a variable is processed through the <code>mutate()</code> function from the <code>{dplyr}</code> package. This function takes as inputs the name of the variable to create, and the <em>formula</em> to consider.
Let’s create two new variables, one called <code>Shiny2</code> which corresponds to <code>Shiny</code> squared up, and one <code>StiMelt</code> which corresponds to <code>Sticky</code> + <code>Melting.</code> Since we only use these three variables, let’s first reduce the data set to these three variables with <code>select()</code> to improve readability:</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="data-manip.html#cb25-1" aria-hidden="true" tabindex="-1"></a>sensory <span class="sc">%&gt;%</span> </span>
<span id="cb25-2"><a href="data-manip.html#cb25-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(Shiny, Sticky, Melting) <span class="sc">%&gt;%</span> </span>
<span id="cb25-3"><a href="data-manip.html#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Shiny2 =</span> Shiny<span class="sc">^</span><span class="dv">2</span>, </span>
<span id="cb25-4"><a href="data-manip.html#cb25-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">StiMelt =</span> Sticky <span class="sc">+</span> Melting)</span></code></pre></div>
<p>Tip: If you want to transform a variable, say by changing its type, or re-writing its content, you can use <code>mutate()</code> and assign to the new variable the same name as the original one. This will overwrite the existing column with the new one. To illustrate this, let’s transform <code>Product</code> from upper case to lower case only. This can be done by mutating <code>Product</code> into the lowercase version of <code>Product</code> (<code>tolower(Product)</code>):</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="data-manip.html#cb26-1" aria-hidden="true" tabindex="-1"></a>sensory <span class="sc">%&gt;%</span> </span>
<span id="cb26-2"><a href="data-manip.html#cb26-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Product =</span> <span class="fu">tolower</span>(Product))</span></code></pre></div>
<p><code>mutate()</code> being one of the most important function from the <code>{dplyr}</code> package, more examples of its use are presented throughout this book.</p>
<p>Since performing mathematical computations on non-numerical columns is not possible, conditions can easily be added through <code>mutate()</code> combined with <code>across()</code>. Let’s imagine we want to round all variables to 0 decimal, which can only be applied to numerical variables.
To do so, we <code>mutate()</code> <code>across()</code> all variables that are considered <code>as.numeric</code> (through <code>where()</code>):</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="data-manip.html#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># round(sensory, 0) returns an error because Judge and Product are characters</span></span>
<span id="cb27-2"><a href="data-manip.html#cb27-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-3"><a href="data-manip.html#cb27-3" aria-hidden="true" tabindex="-1"></a>sensory <span class="sc">%&gt;%</span> </span>
<span id="cb27-4"><a href="data-manip.html#cb27-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric), round, <span class="dv">0</span>))</span></code></pre></div>
<p>In case only a selection of numerical variables should be rounded, we could also replace <code>where(is.numeric)</code> by a vector (using <code>c()</code>) with the names of the variables to round.</p>
</div>
<div id="merging-and-separating-columns" class="section level5" number="4.3.1.1.4">
<h5><span class="header-section-number">4.3.1.1.4</span> Merging and Separating columns</h5>
<p>It can happen that some columns of a data set contain information (strings) that cover different types of information. For instance, we could imagine coding the name of our panelists as <em>FirstName_LastName</em> or <em>Gender_Name</em>, and we would want to separate them into two columns to make the distinction between the different information, i.e. <em>FirstName</em> and <em>LastName</em> or <em>Gender</em> and <em>LastName</em> respectively. In other situations, we may want to merge information present in multiple columns in one.</p>
<p>For illustration, let’s consider the information stored in the <em>Product Info</em> sheet from <em>Sensory Profile.xlsx</em>. This table includes information regarding the cookies, and more precisely their Protein and Fiber content (Low or High).</p>
<p>After importing the data, let’s merge these two columns so that both information is stored in one column called <code>ProtFib</code>.
To do so, we use the <code>unite()</code> function from the <code>{tidyr}</code> package, which takes as first element the name of the new variables, followed by all the columns to <em>unite</em>, and by providing the separation between these elements (here <em>-</em>):</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="data-manip.html#cb28-1" aria-hidden="true" tabindex="-1"></a>file_path <span class="ot">&lt;-</span> <span class="fu">here</span>(<span class="st">&quot;data&quot;</span>,<span class="st">&quot;Sensory Profile.xlsx&quot;</span>) </span>
<span id="cb28-2"><a href="data-manip.html#cb28-2" aria-hidden="true" tabindex="-1"></a>prodinfo <span class="ot">&lt;-</span> <span class="fu">read_xlsx</span>(file_path, <span class="at">sheet=</span><span class="st">&quot;Product Info&quot;</span>) <span class="sc">%&gt;%</span>  </span>
<span id="cb28-3"><a href="data-manip.html#cb28-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unite</span>(ProtFib, Protein, Fiber, <span class="at">sep=</span><span class="st">&quot;-&quot;</span>)</span>
<span id="cb28-4"><a href="data-manip.html#cb28-4" aria-hidden="true" tabindex="-1"></a>prodinfo</span></code></pre></div>
<p>By default, <code>unite()</code> removes from the data set the individual variables that have been merged. To keep these original variables, the parameter <code>remove = FALSE</code> can be used.</p>
<p>Although it is not relevant for combining columns, it is interesting to mention an additional package that can be used to combine elements together. This package is called <code>{glue}</code> and provides interesting alternatives to the usual <code>paste()</code> and <code>paste0()</code> functions.</p>
<p>To reverse the changes (saved here in <code>prodinfo</code>) and to separate a column into different variables, the function <code>separate()</code> from the <code>{tidyr}</code> package is used. Similarly to <code>unite()</code>, <code>separate()</code> takes as first parameter the name of the variable to split, followed by the names for the different segments generated, and of course the separator defined by <code>sep</code>.</p>
<p>In our example, this would be done as following:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="data-manip.html#cb29-1" aria-hidden="true" tabindex="-1"></a>prodinfo <span class="sc">%&gt;%</span> </span>
<span id="cb29-2"><a href="data-manip.html#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">separate</span>(ProtFib, <span class="fu">c</span>(<span class="st">&quot;Protein&quot;</span>,<span class="st">&quot;Fiber&quot;</span>), <span class="at">sep=</span><span class="st">&quot;-&quot;</span>)</span></code></pre></div>
</div>
</div>
<div id="handling-rows" class="section level4" number="4.3.1.2">
<h4><span class="header-section-number">4.3.1.2</span> Handling Rows</h4>
<p>After manipulating columns, the next logical step is to handle rows. Such operations include three aspects,</p>
<ol style="list-style-type: decimal">
<li>Re-arranging the rows in a logical way,</li>
<li>Filtering entries based on given variables,</li>
<li>Splitting the data in sub-groups based on the entries of a variable.</li>
</ol>
<div id="re-arranging-rows" class="section level5" number="4.3.1.2.1">
<h5><span class="header-section-number">4.3.1.2.1</span> Re-arranging Rows</h5>
<p>The first step of re-arranging rows is done through the <code>arrange()</code> function from the <code>{dplyr}</code> package. This function allows sorting the data in the ascending order<a href="#fn11" class="footnote-ref" id="fnref11"><sup>11</sup></a>. To arrange them in a descending order, the function <code>desc()</code> is also required.</p>
<p>Let’s re-arrange the data by Judge and Product, the Judge being sorting in an ascending order whereas the product are being sorted in a descending order:</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="data-manip.html#cb30-1" aria-hidden="true" tabindex="-1"></a>sensory <span class="sc">%&gt;%</span> </span>
<span id="cb30-2"><a href="data-manip.html#cb30-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(Judge, <span class="fu">desc</span>(Product))</span></code></pre></div>
</div>
<div id="filtering-data" class="section level5" number="4.3.1.2.2">
<h5><span class="header-section-number">4.3.1.2.2</span> Filtering Data</h5>
<p>To define sub-set of data, the <code>filter()</code> function is being used. This function requires providing an argument that is expressed as a <em>test</em>, meaning that the outcome should either be TRUE (keep the value) or FALSE (discard the value) when the condition is verified or not respectively. In R, this is expressed by the double ‘=’ sign <code>==</code>.</p>
<p>Let’s filter the data to only keep the data related to sample <code>P02</code>:</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="data-manip.html#cb31-1" aria-hidden="true" tabindex="-1"></a>sensory <span class="sc">%&gt;%</span> </span>
<span id="cb31-2"><a href="data-manip.html#cb31-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Product <span class="sc">==</span> <span class="st">&quot;P02&quot;</span>)</span></code></pre></div>
<p>Other relevant test characters are the following:
- <code>!Product == "P02"</code> or <code>Product != "P02"</code> means different from, and will keep all samples except <code>P02</code>;
- <code>%in% my_vector</code> keeps any value included within the vector <code>my_vector</code> (e.g. <code>Product %in% c("P01","P02","P03")</code>)</p>
<p>In some cases, the tests to perform are more complex as they require multiple conditions.
There are two forms of conditions:</p>
<ul>
<li><code>&amp;</code> (read <em>and</em>) is multiplicative, meaning that all the conditions need to be true (<code>Product == "P02" &amp; Shiny &gt; 40</code>);</li>
<li><code>|</code> (read <em>or</em>) is additive, meaning that only one of the conditions needs to be true (<code>Product == "P03" | Shiny &gt; 40</code>)</li>
</ul>
<p>As we will see later, this option is particularly useful when you have missing values as you could remove all the rows that contain missing values for a given variable. Since we do not have missing values here, let’s create some by replacing all the evaluations for <code>Shiny</code> that are larger than 40 by missing values. This is done here through the <code>ifelse()</code>, which takes three arguments (in this order): the test to perform (here <code>Shiny &gt; 40</code>), the instruction if the test passes (here replace with <code>NA</code>), and the instruction if the test doesn’t pass (here keep the value stored in <code>Shiny</code>).</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="data-manip.html#cb32-1" aria-hidden="true" tabindex="-1"></a>(sensory_na <span class="ot">&lt;-</span> sensory <span class="sc">%&gt;%</span> </span>
<span id="cb32-2"><a href="data-manip.html#cb32-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(Judge, Product, Shiny) <span class="sc">%&gt;%</span> </span>
<span id="cb32-3"><a href="data-manip.html#cb32-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Shiny =</span> <span class="fu">ifelse</span>(Shiny <span class="sc">&gt;</span> <span class="dv">40</span>, <span class="cn">NA</span>, Shiny)))</span></code></pre></div>
<p>In a second step, we filter out all missing values from <code>Shiny</code>. In practice, this is done by keeping all the values that are not missing:</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="data-manip.html#cb33-1" aria-hidden="true" tabindex="-1"></a>sensory_na <span class="sc">%&gt;%</span> </span>
<span id="cb33-2"><a href="data-manip.html#cb33-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(Shiny))</span></code></pre></div>
<p>As we can see, this procedure removed 20 rows since the original table had 99 rows and 3 columns, whereas the filtered table only has 79 rows and 3 columns.</p>
</div>
<div id="splitting-data" class="section level5" number="4.3.1.2.3">
<h5><span class="header-section-number">4.3.1.2.3</span> Splitting Data</h5>
<p>After filtering data, the next logical step is to split data into subsets based on a given variable (e.g. by gender). For such purpose, one could consider using <code>filter()</code> by applying it to each subgroup. In a previous example, this is what we have done when we filtered data for sample <code>P02</code> only.</p>
<p>Of course, we could get sub-groups of data for each sample by repeating the same procedure for all the other samples. However, this procedure becomes tedious as the number of samples increases. Instead, we prefer to use <code>split()</code> which takes as arguments the data and the column to split from:</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="data-manip.html#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">split</span>(sensory, sensory<span class="sc">$</span>Product)</span>
<span id="cb34-2"><a href="data-manip.html#cb34-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-3"><a href="data-manip.html#cb34-3" aria-hidden="true" tabindex="-1"></a><span class="co"># In a pipe, it would be written as (the &#39;.&#39; calls the data):</span></span>
<span id="cb34-4"><a href="data-manip.html#cb34-4" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb34-5"><a href="data-manip.html#cb34-5" aria-hidden="true" tabindex="-1"></a><span class="co"># sensory %&gt;% split(.$Product)</span></span></code></pre></div>
<p>This function creates a list of <em>n</em> elements (<em>n</em> being the number of samples), each element corresponding to the data related to one sample. Such list can then be used in automated analyses by performing on each sub-data through the <code>map()</code> function, as it will be illustrated later.</p>
</div>
</div>
</div>
<div id="reshaping-the-data" class="section level3" number="4.3.2">
<h3><span class="header-section-number">4.3.2</span> Reshaping the Data</h3>
<p>Reshaping the data itself is done through pivoting, hence either creating a long and thin table (CREATE FIGURE), or a short and wide table (CREATE FIGURE). This is done through <code>pivot_longer()</code> and <code>pivot_wider()</code> from <code>{tidyr}</code>.</p>
<!-- Insert Figure illustrating pivot_wider -->
<!-- Insert Figure illustrating pivot_longer -->
<div id="pivotting-longer" class="section level4" number="4.3.2.1">
<h4><span class="header-section-number">4.3.2.1</span> Pivotting Longer</h4>
<!-- Add a section on melt() as special situation of pivotlonger in which all the columns should be pivotted... -->
<p>Currently, our <code>sensory</code> data table is a table in which we have as many rows as Judge x Product, the different attributes being spread across multiple columns. However, in certain situations, it is relevant to have all the attributes stacked vertically, meaning that the table will have Judge x Product x Attributes rows. Such simple transformation can be done through the <code>pivot_longer()</code> function from the <code>{dplyr}</code> package, which takes as inputs the attributes to pivot, the name of the variables that will contain these names (<code>names_to</code>), and the name of the column that will contain their entries (<code>values_to</code>)</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="data-manip.html#cb35-1" aria-hidden="true" tabindex="-1"></a>sensory <span class="sc">%&gt;%</span> </span>
<span id="cb35-2"><a href="data-manip.html#cb35-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(Shiny<span class="sc">:</span>Melting, <span class="at">names_to=</span><span class="st">&quot;Attribute&quot;</span>, <span class="at">values_to=</span><span class="st">&quot;Score&quot;</span>)</span></code></pre></div>
<p>This transformation converts a table of 99 rows and 34 columns into a table with 3168 (99<em>32) rows and 4 columns.
In the pivoted table, the names of the variables (stored here in </em>Attribute*) are in the same order as presented in the original table.</p>
<p>TIPS: With <code>pivot_longer()</code> and any other function that requires selecting variables, it is often easier to deselect variables that we do not want to include rather than selecting all the variables of interest. Throughout the book, both solutions are being considered.</p>
<p>In case the attribute names are following a standard structure, say “attribute_name modality” as is the case in <code>sensory</code> for some attributes, an additional parameter of <code>pivot_longer()</code> becomes handy as it splits the Attribute variable just created into say ‘Attribute’ and ‘Modality.’</p>
<p>To illustrate this, let’s reduce sensory to Judge, Product, and all the variables that end with odor or flavor (all other variables being discarded). After pivoting the subset of columns, we automatically split the attribute names into <em>Attribute</em> and <em>Modality</em> by informing the separator between names (here, a space):</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="data-manip.html#cb36-1" aria-hidden="true" tabindex="-1"></a>sensory <span class="sc">%&gt;%</span> </span>
<span id="cb36-2"><a href="data-manip.html#cb36-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(Judge, Product, <span class="fu">ends_with</span>(<span class="st">&quot;odor&quot;</span>), <span class="fu">ends_with</span>(<span class="st">&quot;flavor&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb36-3"><a href="data-manip.html#cb36-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span><span class="fu">c</span>(Judge,Product), <span class="at">names_to=</span><span class="fu">c</span>(<span class="st">&quot;Attribute&quot;</span>,<span class="st">&quot;Modality&quot;</span>), <span class="at">values_to=</span><span class="st">&quot;Score&quot;</span>, <span class="at">names_sep=</span><span class="st">&quot; &quot;</span>)</span></code></pre></div>
<p>This parameter combines both the power of <code>pivot_longer()</code> and <code>separate()</code> in one unique process.
Note that more complex transformations through the use of regular expressions (and the <code>names_pattern</code> option) can be considered. More information on this topic is provided in REF CHAPTER TEXTUAL (TO CHECK IF IT IS THE CASE!).</p>
<p>Note that the <code>{reshape2}</code> package provides a similar function called <code>melt()</code>, which comes particularly handy if the entire set of numerical variables should be pivoted. In case qualitative variables are present in the data set, they will be kept as <em>id variables</em>. If performed on a matrix with row names, then the new table will have two columns containing the row and column names.</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="data-manip.html#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">melt</span>(sensory)</span></code></pre></div>
</div>
<div id="pivotting-wider" class="section level4" number="4.3.2.2">
<h4><span class="header-section-number">4.3.2.2</span> Pivotting Wider</h4>
<p>The complementary/opposite function to <code>pivot_longer()</code> is <code>pivot_wider()</code>. This function pivots data horizontally, hence reducing the number of rows and increasing the number of columns. In this case, the two main parameters to provide is which column will provide the new column names to create (<code>name_from</code>), and what are the corresponding values to use (<code>values_from</code>).</p>
<p>From the previous example, we could set <code>names_from = Attribute</code> and <code>values_from = Score</code> to return to the original format of sensory. However, let’s reduce the data set to <code>Product</code>, <code>Judge</code>, and <code>Shiny</code> only, and let’s pivot the <code>Judge</code> and <code>Shiny</code> columns:</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="data-manip.html#cb38-1" aria-hidden="true" tabindex="-1"></a>sensory <span class="sc">%&gt;%</span> </span>
<span id="cb38-2"><a href="data-manip.html#cb38-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(Judge, Product, Shiny) <span class="sc">%&gt;%</span> </span>
<span id="cb38-3"><a href="data-manip.html#cb38-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> Judge, <span class="at">values_from =</span> Shiny)</span></code></pre></div>
<p>This procedure creates a table with as many rows as there are products, and as many columns as there are panelists (+1 since the product information is in a column, not defined as row names).</p>
<p>These procedures are particularly useful in consumer studies, since <code>pivot_longer()</code> and <code>pivot_wider()</code> allows restructuring the data for analysis such as ANOVA (<code>pivot_longer()</code> output) and preference mapping or clustering (<code>pivot_wider()</code> structure).</p>
<p>Important remarks: Let’s imagine the sensory test was performed following an incomplete design, meaning that each panelist did not evaluate all the samples. Although the long and thin structure would not show missing values (the entire rows being removed), the shorter and larger version would contain missing values for the products that each panelist did not evaluate. If the user wants to automatically replace these missing values with a fixed value, say, it is possible through the parameter <code>values_fill</code> (e.g. <code>values_fill=0</code> would replace each missing value with a 0). Additionally, after pivoting the data, if multiple entries exist for a combination row-column, <code>pivot_wider()</code> will return a list of elements. In the next Section, an example illustrating such situation and its solution will be presented.</p>
<p>In previous versions of <code>pivot_wider()</code>, the order of the new columns did not match the original order as it would re-organize them alphabetically (mainly if the variable specified in <code>names_from</code> was of type character). If this situation is fixed with later updates (if this should still happen to you, try to update<code>{tidyr}</code>), there was a work around which consists in transforming this variable as a factor (use <code>fct_inorder()</code> to maintain the order as shown in the data) before pivoting it. Indeed, if the variable is of type factor, the new columns are re-ordered based on its levels’ order. Such trick is great to keep in mind as it can help in many other situations (such as ordering elements on a graphic for instance!)</p>
</div>
</div>
<div id="transformation-that-alters-the-data" class="section level3" number="4.3.3">
<h3><span class="header-section-number">4.3.3</span> Transformation that Alters the Data</h3>
<p>In some cases, the final table to generate requires altering the data, by (say) computing the mean across multiple values, or counting the number of occurrences of factor levels for instance. In other words, we summarize the information, which also tend to reduce the size of the table. It is hence no surprise that the function used for such data reduction is called <code>summarise()</code> (<code>{dplyr}</code> package).</p>
<div id="introduction-to-summary-statistics" class="section level4" number="4.3.3.1">
<h4><span class="header-section-number">4.3.3.1</span> Introduction to Summary Statistics</h4>
<p>In practice, <code>summarise()</code> applies a function (whether it is the <code>mean()</code>, or a simple count using <code>n()</code>) on a set of values. Let’s compute the mean on all numerical variables of <code>sensory</code>:</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="data-manip.html#cb39-1" aria-hidden="true" tabindex="-1"></a>sensory <span class="sc">%&gt;%</span> </span>
<span id="cb39-2"><a href="data-manip.html#cb39-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric), mean))</span></code></pre></div>
<p>As can be seen, the grand mean is computed for each attribute.
If multiple functions should be applied, we could perform all the transformation simultaneously as following:</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="data-manip.html#cb40-1" aria-hidden="true" tabindex="-1"></a>sensory <span class="sc">%&gt;%</span> </span>
<span id="cb40-2"><a href="data-manip.html#cb40-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric), <span class="fu">list</span>(<span class="at">min=</span>min, <span class="at">max=</span>max)))</span></code></pre></div>
<p>In this example, each attribute is duplicated with "_min" and "_max" to provide the minimum and maximum value for each attribute. By using a combination of <code>pivot_longer()</code> (or <code>reshape2::melt()</code>) with <code>names_sep</code> followed by <code>pivot_wider()</code>, we could easily restructure such table by showing for each attribute (presented in rows) the minimum and the maximum in two different columns.</p>
<p>By following the same principles, many other functions can be performed, whether they are built-in R or created by the user.
Here is a recommendation of interesting descriptive functions to consider with <code>summarise()</code>:</p>
<ul>
<li><code>mean()</code>, <code>median()</code> (or more generally <code>quantile()</code>) for the mean and median (or any other quantile);</li>
<li><code>sd()</code> and <code>var()</code> for the standard deviation and the variance;</li>
<li><code>min()</code>, <code>max()</code>, <code>range()</code> (provides both the min and max) or <code>diff(range())</code> (for the difference between min and max);</li>
<li><code>n()</code> and <code>sum()</code> for the number of counts and the sum respectively.</li>
</ul>
</div>
<div id="introduction-to-grouping" class="section level4" number="4.3.3.2">
<h4><span class="header-section-number">4.3.3.2</span> Introduction to <em>grouping</em></h4>
<p>It can appear that the interest is not in the grand mean, but in the mean per product (say), or per product and panelist in case the test has been duplicated. In such cases, <code>summarize()</code> should aggregate set of values per product, or per product by panelist respectively. Such information can be passed on through <code>group_by()</code><a href="#fn12" class="footnote-ref" id="fnref12"><sup>12</sup></a>.</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="data-manip.html#cb41-1" aria-hidden="true" tabindex="-1"></a>sensory <span class="sc">%&gt;%</span> </span>
<span id="cb41-2"><a href="data-manip.html#cb41-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Product) <span class="sc">%&gt;%</span> </span>
<span id="cb41-3"><a href="data-manip.html#cb41-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric), mean)) <span class="sc">%&gt;%</span> </span>
<span id="cb41-4"><a href="data-manip.html#cb41-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code></pre></div>
<p>This procedure creates a tibble with 11 rows (product) and 33 columns (32 sensory attributes + 1 column including the product information) which contains the mean per attribute for each sample, also known as the sensory profiles of the products.</p>
</div>
<div id="illustrations-of-data-manipulation" class="section level4" number="4.3.3.3">
<h4><span class="header-section-number">4.3.3.3</span> Illustrations of Data Manipulation</h4>
<p>Let’s review the different transformations presented earlier by generating the sensory profiles of the samples through different approaches<a href="#fn13" class="footnote-ref" id="fnref13"><sup>13</sup></a>.</p>
<p>In the previous example, we’ve seen how to obtain the sensory profile using <code>summarise()</code> <code>across()</code> all numerical variables. In case a selection of the attributes should have been done, we could use the same process by simply informing which attributes to transform:</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="data-manip.html#cb42-1" aria-hidden="true" tabindex="-1"></a>sensory <span class="sc">%&gt;%</span> </span>
<span id="cb42-2"><a href="data-manip.html#cb42-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Product) <span class="sc">%&gt;%</span> </span>
<span id="cb42-3"><a href="data-manip.html#cb42-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(Shiny<span class="sc">:</span>Melting, mean)) <span class="sc">%&gt;%</span> </span>
<span id="cb42-4"><a href="data-manip.html#cb42-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code></pre></div>
<p>The list of attributes to include can also be stored in an external vector:</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="data-manip.html#cb43-1" aria-hidden="true" tabindex="-1"></a>sensory_attr <span class="ot">&lt;-</span> <span class="fu">colnames</span>(sensory)[<span class="dv">5</span><span class="sc">:</span><span class="fu">ncol</span>(sensory)]</span>
<span id="cb43-2"><a href="data-manip.html#cb43-2" aria-hidden="true" tabindex="-1"></a>sensory <span class="sc">%&gt;%</span> </span>
<span id="cb43-3"><a href="data-manip.html#cb43-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Product) <span class="sc">%&gt;%</span> </span>
<span id="cb43-4"><a href="data-manip.html#cb43-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">all_of</span>(sensory_attr), mean)) <span class="sc">%&gt;%</span> </span>
<span id="cb43-5"><a href="data-manip.html#cb43-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code></pre></div>
<p>Remark: It is important to notice that when <code>group_by()</code> is being called, the software will remember the groups unless stated otherwise. This means that any subsequent transformation performed on the previous table will be done by product. Such property can be causing unexpected results in case transformations should be performed across all samples. To avoid such behavior, we strongly recommend you to apply <code>ungroup()</code> as soon as the results per group have been generated.</p>
<p>A different approach consists in combining <code>summarise()</code> to <code>pivot_longer()</code> and <code>pivot_wider()</code>. This process requires summarizing only one column by Product and Attribute:</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="data-manip.html#cb44-1" aria-hidden="true" tabindex="-1"></a>sensory <span class="sc">%&gt;%</span> </span>
<span id="cb44-2"><a href="data-manip.html#cb44-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(Shiny<span class="sc">:</span>Melting, <span class="at">names_to=</span><span class="st">&quot;Attribute&quot;</span>, <span class="at">values_to=</span><span class="st">&quot;Scores&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb44-3"><a href="data-manip.html#cb44-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Attribute =</span> <span class="fu">fct_inorder</span>(Attribute)) <span class="sc">%&gt;%</span> </span>
<span id="cb44-4"><a href="data-manip.html#cb44-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Product, Attribute) <span class="sc">%&gt;%</span> </span>
<span id="cb44-5"><a href="data-manip.html#cb44-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">Scores =</span> <span class="fu">mean</span>(Scores)) <span class="sc">%&gt;%</span> </span>
<span id="cb44-6"><a href="data-manip.html#cb44-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from=</span>Attribute, <span class="at">values_from=</span>Scores) <span class="sc">%&gt;%</span> </span>
<span id="cb44-7"><a href="data-manip.html#cb44-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span></code></pre></div>
<p>Note that through this procedure, we transformed <code>Attribute</code> into a factor using <code>fct_inorder()</code> to ensure that the double pivoting procedure maintains the original attributes’ order. Without this line of code, the final table would have the columns reordered alphabetically.</p>
<p>What would happen if we would omit to <code>summarise()</code> the data in between the two pivoting functions? In that case, we also remove Judge which were lost in the process…</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="data-manip.html#cb45-1" aria-hidden="true" tabindex="-1"></a>sensory <span class="sc">%&gt;%</span> </span>
<span id="cb45-2"><a href="data-manip.html#cb45-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(Shiny<span class="sc">:</span>Melting, <span class="at">names_to=</span><span class="st">&quot;Attribute&quot;</span>, <span class="at">values_to=</span><span class="st">&quot;Scores&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb45-3"><a href="data-manip.html#cb45-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>Judge) <span class="sc">%&gt;%</span> </span>
<span id="cb45-4"><a href="data-manip.html#cb45-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from=</span>Attribute, <span class="at">values_from=</span>Scores)</span></code></pre></div>
<p>As can be seen, each variable is of type list in which each cell contains <code>dbl [9]</code>: This corresponds to the scores provided by the 9 panelists to that product and that attribute. Since we would ultimately want the mean of these 9 values to generate the sensory profiles, a solution comes directly within <code>pivot_wider()</code> through the parameter <code>values_fn</code> which applies the function provided here on each set of values:</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="data-manip.html#cb46-1" aria-hidden="true" tabindex="-1"></a>sensory <span class="sc">%&gt;%</span> </span>
<span id="cb46-2"><a href="data-manip.html#cb46-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(Shiny<span class="sc">:</span>Melting, <span class="at">names_to=</span><span class="st">&quot;Attribute&quot;</span>, <span class="at">values_to=</span><span class="st">&quot;Scores&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb46-3"><a href="data-manip.html#cb46-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>Judge) <span class="sc">%&gt;%</span> </span>
<span id="cb46-4"><a href="data-manip.html#cb46-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from=</span>Attribute, <span class="at">values_from=</span>Scores, <span class="at">values_fn=</span>mean)</span></code></pre></div>
</div>
</div>
<div id="combining-data-from-different-sources" class="section level3" number="4.3.4">
<h3><span class="header-section-number">4.3.4</span> Combining Data from Different Sources</h3>
<p>It often happens that the data to analyze is stored in different files, and need to be combined or merged. Depending on the situations, different solutions are required.</p>
<div id="binding-by-rows" class="section level4" number="4.3.4.1">
<h4><span class="header-section-number">4.3.4.1</span> Binding by Rows</h4>
<p>Let’s start with a simple example where the tables match in terms of variables, and should be combined vertically.
To do so, we use the file <em>excel-scrap.xlsx</em> which contains a fake example in which 12 assessors evaluated 2 samples on 3 attributes in triplicate, each replication being stored in a different sheet.</p>
<p>The goal here is to read the data stored in the different sheets, and to combine them in one unique file.</p>
<p>To combine the tables vertically, we could use the basic R function <code>rbind()</code>. However, we prefer to use <code>bind_rows()</code> from <code>{dplyr}</code> since it better controls for the columns by ensuring that the order is respected. And in case one table contains a variable that the other tables don’t, this variable will be kept and filled in with NAs when the information is missing.</p>
<p>To keep the distinction between the three tables, the parameter <code>.id</code> is used. This will create a column called <code>Session</code> in this example that will assign a 1 to the first table, a 2 to the second one, and a 3 to the third one (This process is used to avoid losing this information as it was not directly available within the data: If it were, the parameter <code>.id</code> could have been ignored).</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="data-manip.html#cb47-1" aria-hidden="true" tabindex="-1"></a>path <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;excel_scrap.xlsx&quot;</span>)</span>
<span id="cb47-2"><a href="data-manip.html#cb47-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-3"><a href="data-manip.html#cb47-3" aria-hidden="true" tabindex="-1"></a>session1 <span class="ot">&lt;-</span> <span class="fu">read_xlsx</span>(path, <span class="at">sheet=</span><span class="dv">1</span>)</span>
<span id="cb47-4"><a href="data-manip.html#cb47-4" aria-hidden="true" tabindex="-1"></a>session2 <span class="ot">&lt;-</span> <span class="fu">read_xlsx</span>(path, <span class="at">sheet=</span><span class="dv">2</span>) </span>
<span id="cb47-5"><a href="data-manip.html#cb47-5" aria-hidden="true" tabindex="-1"></a>session3 <span class="ot">&lt;-</span> <span class="fu">read_xlsx</span>(path, <span class="at">sheet=</span><span class="dv">3</span>)</span>
<span id="cb47-6"><a href="data-manip.html#cb47-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-7"><a href="data-manip.html#cb47-7" aria-hidden="true" tabindex="-1"></a>all_data <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(session1, session2, session3, <span class="at">.id =</span> <span class="st">&quot;Session&quot;</span>)</span></code></pre></div>
<p>Although this solution works fine, another neater and tidier solution will be presented in <a href="data-collection.html#import-mult-sheet">8.3.3</a>.</p>
</div>
<div id="combining-tables-by-columns" class="section level4" number="4.3.4.2">
<h4><span class="header-section-number">4.3.4.2</span> Combining Tables by column(s)</h4>
<p>Similarly, tables can be combined horizontally using the corresponding function <code>cbind()</code> (<code>{base}</code>) and/or <code>bind_cols()</code> (<code>{dplyr}</code>). In this case, it is better to ensure that the rows’ order is identical before combining to avoid mishaps, and the tables should be of the same size.</p>
<p>If that is not the case, mergeing tables should be done using <code>merge()</code> (<code>{base}</code>), or preferably through the different <code>*_join()</code> functions from (<code>{dplyr}</code>). Depending on the <em>merging degree</em> to consider between tables X and Y, there are four different <code>*_join()</code> versions to consider:</p>
<ul>
<li><code>full_join()</code> keeps all the cases from X and Y regardless whether they are present in the other table or not (in case they are not present, NAs will be introduced) [it corresponds to <code>merge(all=TRUE)</code>];</li>
<li><code>inner_join()</code> only keeps the common cases, i.e. cases that are present in both X and Y [corresponds to <code>merge(all=FALSE)</code>];</li>
<li><code>left_join()</code> keeps all the cases from X [corresponds to <code>merge(all.x=TRUE, all.y=FALSE)</code>];</li>
<li><code>right_join()</code> keeps all the cases from Y [corresponds to <code>merge(all.x=FALSE, all.y=TRUE)</code>];</li>
<li><code>anti_join()</code> only keeps the elements from X that are not present in Y (this is particularly useful if you have a tibble Y of elements that you would like to remove from X).</li>
</ul>
<!-- Add examples with X=ABC, Y=ABD and full=ABCD, inner=AB, left=ABC, right=ABD, anti=CD  -->
<p>The merging procedure requires the users to provide a <em>key</em>, i.e. a (set of) variable(s) used to combine the tables. For each unique element defined by the key, a line is being created. When needed, rows of a table are being duplicated. Within the different <code>*_join()</code> functions, the key is informed by the <code>by</code> parameter, which may contain one or more variables with the same or different names.</p>
<p>To illustrate, let’s use the data set called <em>Consumer Test.xlsx</em>, which contains three tabs:</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="data-manip.html#cb48-1" aria-hidden="true" tabindex="-1"></a>file_path <span class="ot">&lt;-</span> <span class="fu">here</span>(<span class="st">&quot;data&quot;</span>,<span class="st">&quot;Consumer Test.xlsx&quot;</span>)</span>
<span id="cb48-2"><a href="data-manip.html#cb48-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-3"><a href="data-manip.html#cb48-3" aria-hidden="true" tabindex="-1"></a><span class="fu">excel_sheets</span>(file_path)</span></code></pre></div>
<p>The three sheets contain the following information, which need to be combined:</p>
<ul>
<li><em>Biscuits</em>: The consumers’ evaluation of the 10 products and their assessment on liking, hunger, etc. at different moments of the test.</li>
<li><em>Time Consumption</em>: The amount of cookies and the time required to evaluate them in each sitting.</li>
<li><em>Weight</em>: The weight associated to each cookie.</li>
</ul>
<p>Let’s start by combining <em>Time Consumption</em> and <em>Weight</em> so that we can compute the total weight of biscuits eaten by each respondent in each sitting. In this case, the joining procedure is done by <code>Product</code> since the weight is only provided for each product. The total weight eaten (<code>Amount</code>) is then computed by multiplying the number of cookies eaten (<code>Nb biscuits</code>) by <code>Weight</code></p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="data-manip.html#cb49-1" aria-hidden="true" tabindex="-1"></a>time <span class="ot">&lt;-</span> <span class="fu">read_xlsx</span>(file_path, <span class="at">sheet=</span><span class="st">&quot;Time Consumption&quot;</span>)</span>
<span id="cb49-2"><a href="data-manip.html#cb49-2" aria-hidden="true" tabindex="-1"></a>weight <span class="ot">&lt;-</span> <span class="fu">read_xlsx</span>(file_path, <span class="at">sheet=</span><span class="st">&quot;Weight&quot;</span>)</span>
<span id="cb49-3"><a href="data-manip.html#cb49-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-4"><a href="data-manip.html#cb49-4" aria-hidden="true" tabindex="-1"></a>(consumption <span class="ot">&lt;-</span> time <span class="sc">%&gt;%</span> </span>
<span id="cb49-5"><a href="data-manip.html#cb49-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">full_join</span>(weight, <span class="at">by=</span><span class="st">&quot;Product&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb49-6"><a href="data-manip.html#cb49-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Amount =</span> <span class="st">`</span><span class="at">Nb biscuits</span><span class="st">`</span><span class="sc">*</span>Weight))</span></code></pre></div>
<p>As can be seen, the <code>Weight</code> information stored in the <em>Weight</em> sheet has been replicated every time each sample has been evaluated by another respondent.</p>
<p>The next step is then to merge this table to <code>Biscuits</code>. In this case, since both data set contain the full evaluation of the cookies (each consumer evaluating each product), the joining procedure needs to be done by <code>Judge</code> and <code>Product</code> simultaneously. A quick look at the data shows two important things:</p>
<ul>
<li>In <em>Biscuits</em>, the consumer names only contains the numbers whereas in <code>consumption</code>, they also contain a <code>J</code> in front of the name: This needs to be fixed as the names need to be identical to be merged, else they will be considered separately and NAs will be introduced. In practice, this will be done by mutating <code>Consumer</code> and by pasting a <code>J</code> in front of the number using the function <code>paste0()</code>.</li>
<li>The names that contain the product (<code>Samples</code> and <code>Product</code>) and consumers (<code>Consumer</code> and <code>Judge</code>) information are different in both data set. We could rename these columns in one data set to match the other, but instead we will keep the two names and inform it within <code>full_join()</code>. This is done through the <code>by</code> parameter as following: <code>"name in dataset 1" = "name in dataset 2"</code></li>
</ul>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="data-manip.html#cb50-1" aria-hidden="true" tabindex="-1"></a>biscuits <span class="ot">&lt;-</span> <span class="fu">read_xlsx</span>(file_path, <span class="at">sheet=</span><span class="st">&quot;Biscuits&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb50-2"><a href="data-manip.html#cb50-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Consumer =</span> <span class="fu">str_c</span>(<span class="st">&quot;J&quot;</span>,Consumer)) <span class="sc">%&gt;%</span> </span>
<span id="cb50-3"><a href="data-manip.html#cb50-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">full_join</span>(consumption, <span class="at">by=</span><span class="fu">c</span>(<span class="st">&quot;Consumer&quot;</span><span class="ot">=</span><span class="st">&quot;Judge&quot;</span>, <span class="st">&quot;Samples&quot;</span><span class="ot">=</span><span class="st">&quot;Product&quot;</span>))</span>
<span id="cb50-4"><a href="data-manip.html#cb50-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-5"><a href="data-manip.html#cb50-5" aria-hidden="true" tabindex="-1"></a>biscuits</span></code></pre></div>
<p>The three data sets are now flawlessly joined into one and can be further analysed.</p>

</div>
</div>
</div>
</div>
<div class="footnotes">
<hr />
<ol start="8">
<li id="fn8"><p>Note that some of the examples presented in this chapter emphasize the “how to?,” not the “why?,” and are not necessarily chosen to convey scientific meaning<a href="data-manip.html#fnref8" class="footnote-back">↩︎</a></p></li>
<li id="fn9"><p>The <em>sensory</em> data are imported from the <em>Sensory Profile.xlsx</em> file, see Section <a href="data-collection.html#data-import">8.3</a> for more on how to import data sets<a href="data-manip.html#fnref9" class="footnote-back">↩︎</a></p></li>
<li id="fn10"><p>Note that many other packages include a function called <code>select()</code>, which could create conflicts. To avoid any risks of errors, we recommend calling it as <code>dplyr::select()</code> to formally call <code>select()</code> from <code>{dplyr}</code>. This avoids any risks of error! Of course, the same procedure applies to any other functions that may suffer from the same issue.<a href="data-manip.html#fnref10" class="footnote-back">↩︎</a></p></li>
<li id="fn11"><p>For numerical order, this is simply re-arranging the values from the lowest to the highest. For strings, the entries are then sorted alphabetically unless the variable is a factor in which case the order of the levels for that factors are being used.<a href="data-manip.html#fnref11" class="footnote-back">↩︎</a></p></li>
<li id="fn12"><p>We strongly recommend you to <code>ungroup()</code> blocks of code that includes <code>group_by()</code> once the computations are done to avoid any unexpected results.<a href="data-manip.html#fnref12" class="footnote-back">↩︎</a></p></li>
<li id="fn13"><p>It is important to realize that any <em>data manipulation challenge</em> can be solved in many different ways, so don’t be afraid to think out of the box when solving them…<a href="data-manip.html#fnref13" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="data-science.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="data-viz.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["i2ds4scc_bookdown.pdf", "i2ds4scc_bookdown.epub"],
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
